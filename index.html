<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Feairl Key System</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #0a0a0a;
        color: #e0e0e0;
        font-family: "Segoe UI", Arial, sans-serif;
        text-align: center;
    }

    h1 {
        margin-top: 60px;
        font-size: 40px;
        color: #8b5dff;
        text-shadow: 0 0 10px #8b5dff;
    }

    #content {
        margin-top: 40px;
        font-size: 20px;
    }

    .btn {
        padding: 14px 32px;
        background: linear-gradient(135deg, #6c47ff, #9b7cff);
        border: none;
        border-radius: 10px;
        font-size: 20px;
        color: #fff;
        cursor: pointer;
        transition: 0.22s;
        box-shadow: 0 0 12px #6c47ff88;
    }

    .btn:hover {
        transform: scale(1.07);
        box-shadow: 0 0 18px #9b7cffcc;
    }

    .keybox {
        margin-top: 20px;
        font-size: 28px;
        padding: 12px 22px;
        background: #111;
        border-radius: 8px;
        display: inline-block;
        color: #40ff9c;
        box-shadow: 0 0 12px #40ff9c66;
    }

</style>
</head>

<body>

<h1>Feairl Key System</h1>

<div id="content">è¼‰å…¥ä¸­...</div>


<script>
/* ---------------- Cookie è®€å¯« ------------------- */
function setCookie(name, value, hours) {
    let expires = "";
    if (hours) {
        let date = new Date();
        date.setTime(date.getTime() + (hours*60*60*1000)); 
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}

function getCookie(name) {
    let nameEQ = name + "=";
    let ca = document.cookie.split(';');
    for(let i=0;i < ca.length;i++) {
        let c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) 
            return c.substring(nameEQ.length,c.length);
    }
    return null;
}

/* ---------------- ä¸»æµç¨‹ ------------------- */
async function loadPage(){

    // ğŸŸ£ï¼ˆ1ï¼‰å…ˆæª¢æŸ¥ Cookieï¼Œæœ‰ Key å°±ç›´æ¥é¡¯ç¤ºï¼Œä¸è·‘ Step
    let savedKey = getCookie("laobei_key");
    if (savedKey){
        document.getElementById("content").innerHTML = `
            <div class="keybox">${savedKey}</div>
            <p style="opacity:0.6;font-size:15px;">ï¼ˆå·²å¾ Cookie è¼‰å…¥ï¼Œä¸éœ€é‡æ–°é©—è­‰ï¼‰</p>
        `;
        return;
    }

    // ğŸŸ£ï¼ˆ2ï¼‰æ²’æœ‰ Key â†’ æ­£å¸¸ Step æµç¨‹
    const url = new URL(window.location.href);
    const token = url.searchParams.get("token");
    const done = url.searchParams.get("done");

    let res = await fetch(`/api/generate?token=${token || ""}&done=${done || ""}`);
    let data = await res.json();


    /* ---------- Step 1 ---------- */
    if (data.step === 1){
        document.getElementById("content").innerHTML = `
            <h2>Step 1</h2>
            <button class="btn"
                onclick="location.href='https://work.ink/26Yy/feairl-keysystem?redirect=https%3A%2F%2Fkey-1n3s.vercel.app%2F%3Ftoken%3D${data.token}%26done%3D1'">
                Continue
            </button>
        `;
        return;
    }


    /* ---------- Step 2 ---------- */
    if (data.step === 2){
        document.getElementById("content").innerHTML = `
            <h2>Step 2</h2>
            <button class="btn"
                onclick="location.href='https://work.ink/26Yy/feairl-keysystem-1?redirect=https%3A%2F%2Fkey-1n3s.vercel.app%2F%3Ftoken%3D${data.token}%26done%3D1">
                Continue
            </button>
        `;
        return;
    }


    /* ---------- Step å®Œæˆ â†’ é¡¯ç¤º KEY ---------- */
    if (data.step === "key"){
        // å­˜åˆ° Cookieï¼ˆæœ‰æ•ˆæœŸï¼š24 å°æ™‚ï¼‰
        setCookie("laobei_key", data.key, 24);

        document.getElementById("content").innerHTML = `
            <h2>ä½ çš„ KEY</h2>
            <div class="keybox">${data.key}</div>
            <p style="opacity:0.7;margin-top:10px;">ï¼ˆå·²è‡ªå‹•ä¿å­˜ï¼Œä¸‹æ¬¡å…é©—è­‰ï¼‰</p>
        `;
        return;
    }
}

loadPage();
</script>

</body>
</html>




<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Redirecting...</title>
</head>
<body style="background:#0f0f0f; color:white; font-family:sans-serif;">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ---------------- Firebase 設定 ----------------
const firebaseConfig = {
    apiKey: "AIzaSyCRdYTxHGhDQvQgnzwIWutPhXLfFm4485X0",
    authDomain: "keysystem-2f263.firebaseapp.com",
    databaseURL: "https://keysystem-2f263-default-rtdb.firebaseio.com",
    projectId: "keysystem-2f263",
    storageBucket: "keysystem-2f263.firebasestorage.app",
    messagingSenderId: "212352827734",
    appId: "1:212352827734:web:f2b0f401d206ac483796f7",
    measurementId: "G-83FH95F22W"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---------------- 產生 Token ----------------
function generateToken(length = 20) {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let token = "";
    for (let i = 0; i < length; i++) {
        token += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return token;
}

const token = generateToken();

// ---------------- 將 Token 儲存到 Firebase ----------------
db.ref("tokens/" + token).set({
    valid: true,
    created: Date.now()
}).then(() => {

    // ---- Work.ink 跳轉網址（⚡請換成你的 Work.ink）----
    const workinkUrl = "https://work.ink/26Yy/feairl-key-system";

    // ---- 完成 Work.ink 後回到 key 頁面 ----
    const returnUrl = `https://feairl2.github.io/key/?token=${token}`;

    // Work.ink 支援 returnURL，這樣才能跳回你的頁面
    window.location.href = `${workinkUrl}?r=${encodeURIComponent(returnUrl)}`;

});
</script>

<div style="text-align:center; margin-top:50px;">
    <h2>正在產生驗證資料...</h2>
</div>

</body>
</html>
